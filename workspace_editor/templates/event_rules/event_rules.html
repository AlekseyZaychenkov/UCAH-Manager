{% extends 'base.html' %} {% load widget_tweaks %} {% block content %}
{% load static %}

<style>
.hr {
  margin-top: 0;
  padding-top: 0;
}
</style>



<div class="container-fluid">
    {% block top_menu %}
    {% include 'event_rules/event_rules_top_panel.html' %}
    {% endblock %}

    <hr class="hr">

    <form method="post" class="mt-3"> {% csrf_token %}
        <div class="d-none">
            {% render_field event_rules_edit_form.event_rules_id|append_attr:"readonly:readonly" value=event_rules.event_rules_id %}
        </div>

        <div class="d-flex justify-content-around">
            <h4>Time slots</h4>
            <div class="form-row">
                <label>Distribution type:</label>
                {% render_field event_rules_edit_form.distribution_type %}
                {{ event_rules_edit_form.distribution_type.errors }}
            </div>
            <div class="form-row">
                <label>Distribution type:</label>
                {% render_field event_rules_edit_form.start_type %}
                {{ event_rules_edit_form.start_type.errors }}
            </div>
        </div>

        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th scope="col">Priority 1 (1 post per day)</th>
                    <th scope="col">Priority 2 (2 post per day)</th>
                    <th scope="col">Priority 3 (3 post per day)</th>
                    <th scope="col">Priority 4 (4 post per day)</th>
                    <th scope="col">Priority 5 (5 post per day)</th>
                    <th scope="col">Priority 6 (6 post per day)</th>
                </tr>
            </thead>
            <tbody>
                {% for posting_time_row in posting_time_rows.values %}
                    <tr>
                    {% for posting_time_and_form in posting_time_row %}
                        <td>
                            {% if posting_time_and_form %}

                                {% with posting_time_obj=posting_time_and_form|get_item:"posting_time_obj" posting_time_form=posting_time_and_form|get_item:"posting_time_form" %}
                                    <div class="d-none">
                                        {% render_field posting_time_form.posting_time_id|append_attr:"readonly:readonly" value=posting_time_obj.posting_time_id %}
                                    </div>

                                    <div class="form-row">
                                        {% render_field posting_time_form.time class="form-control" type="time" %}
                                        {{ posting_time_form.time.errors }}
                                    </div>
                                {% endwith %}
                            {% endif %}
                        </td>
                    {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="d-flex justify-content-center">
            <button class="btn btn-primary" type="submit" name="action" value="save_event_rules">Save types and posting times</button>
        </div>
    </form>


    <h4>Tag rules</h4>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th scope="col">Input tag</th>
                <th scope="col">Output tag</th>
                <th scope="col">Blog(-s)</th>
                <th scope="col">Delete</th>
            </tr>
        </thead>
        <tbody>
        {% for tag_rule, blogs in tag_rule_rows %}
            <tr>
                <td>
                    {{tag_rule.name}}
                </td>
                <td>
                    {{account.credentials.resource}}
                </td>
                <td>
                    {% for blog in blogs %}
                        <a type="button" class="btn btn-sm btn-secondary"
                           href="{% url 'resource_account_add_blog' workspace_id=workspace.workspace_id resource_account_id=account.resource_account_id %}">Show to add from list</a>
                    {% endfor %}

                    <img src="{{MEDIA_LOCATION}}/{{account.avatar}}" class="img-fluid" style="height: 30px; object-fit: contain;" alt="">
                </td>
                <td>
                    <a type="button" class="btn btn-sm btn-danger rounded-circle"
                       href="{% url 'event_rules_tag_rule_delete' workspace_id=workspace.workspace_id tag_rule_id=tag_rule.tag_rule_id %}">X</a>
                    <script>
                        {% if "delete" in request.path %}
                            $(function() {
                                $('#tag_rule_delete_modal').modal({show: true});
                            });
                        {% endif %}
                    </script>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <div class="d-none">
        {% render_field blog_delete_form.id|append_attr:"readonly:readonly" class="form-control" value=blog_id %}
    </div>


    <div class="mx-auto" style="width: 200px;">
        <button type="button" class="btn btn-sm btn-outline-dark" data-toggle="modal"
                data-target="#tag_rule_create_modal">Add new tag rule</button>
    </div>




    {% block event_rules_modals %}
    {% include 'event_rules/event_rules_modals.html' %}
    {% endblock %}

</div>

{% endblock content %}