{% extends 'base.html' %} {% load widget_tweaks %} {% block content %}
{% load static %}

<style>
.hr {
  margin-top: 0;
  padding-top: 0;
}
</style>



<div class="container-fluid">
    {% block top_menu %}
    {% include 'event_rules/event_rules_top_panel.html' %}
    {% endblock %}

    <hr class="hr">

    <form method="post" class="mt-3"> {% csrf_token %}
        <div class="d-none">
            {% render_field event_rules_edit_form.event_rules_id|append_attr:"readonly:readonly" value=event_rules.event_rules_id %}
        </div>

        <div class="d-flex justify-content-around">
            <h4>Time slots</h4>
            <div class="form-row">
                <label>Distribution type:</label>
                {% render_field event_rules_edit_form.distribution_type %}
                {{ event_rules_edit_form.distribution_type.errors }}
            </div>
            <div class="form-row">
                <label>Distribution type:</label>
                {% render_field event_rules_edit_form.start_type %}
                {{ event_rules_edit_form.start_type.errors }}
            </div>
        </div>

        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th scope="col">Priority 1 (1 post per day)</th>
                    <th scope="col">Priority 2 (2 post per day)</th>
                    <th scope="col">Priority 3 (3 post per day)</th>
                    <th scope="col">Priority 4 (4 post per day)</th>
                    <th scope="col">Priority 5 (5 post per day)</th>
                    <th scope="col">Priority 6 (6 post per day)</th>
                </tr>
            </thead>
            <tbody>
                {% for posting_time_row in posting_time_rows.values %}
                    <tr>
                    {% for posting_time_and_form in posting_time_row %}
                        <td>
                            {% if posting_time_and_form %}
                                {% for posting_time, form in posting_time_and_form.items %}
                                    <div class="d-none">
                                        {% render_field form.posting_time_id|append_attr:"readonly:readonly" class="form-control" value=posting_time.posting_time_id %}
                                    </div>
                                    <div class="form-row">
                                        {% render_field form.time class="form-control" type="time" %}
                                        {{ form.time.errors }}
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </td>
                    {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="d-flex justify-content-center">
            <button class="btn btn-primary" type="submit" name="action" value="event_rules_save">Save types and posting times</button>
        </div>
    </form>


    <h4>Tag rules</h4>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th scope="col">Input tag</th>
                <th scope="col">Output tag</th>
                <th scope="col">Blog(-s)</th>
                <th scope="col">Edit</th>
                <th scope="col">Delete</th>
            </tr>
        </thead>
        <tbody>
        {% for tag_rule, blogs in tag_rule_rows.items %}
            <tr>
                <td>
                    &#39;{{ tag_rule.input }}&#39;
                </td>
                <td>
                    &#39;{{ tag_rule.output }}&#39;
                </td>
                <td>
                    {% if tag_rule.for_all %}
                        <h5 style="display: inline-block;">(all) </h5>
                    {% endif %}
                    {% for blog in blogs %}
                        <img src="{{BLOGS_MEDIA_LOCATION}}/{{blog.blog_id}}/{{blog.avatar}}" class="img-fluid" style="height: 30px; object-fit: contain;" alt="">
                        {{ blog.name }}
                        <h5 style="display: inline-block;"> </h5>
                    {% endfor %}
                </td>
                <td>

                </td>
                <td>
                    <a type="button" class="btn btn-sm btn-danger rounded-circle"
                       href="{% url 'event_rules_tag_rules_tag_rule_delete' workspace_id=workspace.workspace_id tag_rule_id=tag_rule.tag_rule_id %}">X</a>
                    <script>
                        {% if "delete" in request.path %}
                            $(function() {
                                $('#tag_rule_delete_modal').modal({show: true});
                            });
                        {% endif %}
                    </script>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
<!--    <div class="d-none">-->
<!--        {% render_field blog_delete_form.id|append_attr:"readonly:readonly" class="form-control" value=blog_id %}-->
<!--    </div>-->

    <h4>Tag rules</h4>

    <div class="d-flex justify-content-start">
        <button type="button" class="btn btn-sm btn-outline-dark" data-toggle="modal"
                data-target="#tag_rule_create_modal">Add new tag rule</button>
    </div>




    {% block event_rules_modals %}
    {% include 'event_rules/event_rules_modals.html' %}
    {% endblock %}

</div>

{% endblock content %}